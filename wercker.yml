box: killercentury/sbt
build:
  steps:
    - script:
      name: check JDK
      code: |
        java -version
    - script:
      name: install sass
      code: |
        apt-get install -y ruby ruby-dev libffi-dev gcc make
        gem install sass compass --no-ri --no-doc
    - script:
      name: install typescript
      code: |
        apt-get install -y npm
        npm install -g typescript
    - script:
      name: sbt test and coverage
      code: |
        sbt compile
        sbt coverage test
        sbt coverageReport
    - script:
      name: sbt dist
      code: |
        sbt dist
    - script:
      name: install unzip
      code: |
        apt-get install -y unzip
    - script:
      name: unzip dist
      code: |
        unzip ./target/universal/neta-inbox-*.zip -d "$WERCKER_OUTPUT_DIR/staging"
        unzip ./target/universal/neta-inbox-*.zip -d "$WERCKER_OUTPUT_DIR/production"
    - script:
      name: config files
      code: |
        DIST_NAME=`ls ./target/universal/neta-inbox-*.zip | sed "s/.*\/\(neta.*\).zip/\1/"`
        sed -i -r "s/(auth0.callbackURL).*/\1=\"$AUTH0_CALLBACK_URL_STAGING\"/" "$WERCKER_OUTPUT_DIR/staging/$DIST_NAME/conf/application.conf"
        sed -i -r "s/(auth0.callbackURL).*/\1=\"$AUTH0_CALLBACK_URL_PRODUCTION\"/" "$WERCKER_OUTPUT_DIR/production/$DIST_NAME/conf/application.conf"

